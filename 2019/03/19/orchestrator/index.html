<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="一条大河" />



<meta name="description" content="摘要：使用orchestrator实现mysql主从自动切换、故障转移、拓扑管理。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL高可用探索之orchestrator">
<meta property="og:url" content="http://riverdba.github.io/2019/03/19/orchestrator/index.html">
<meta property="og:site_name" content="Yangtze River's blog">
<meta property="og:description" content="摘要：使用orchestrator实现mysql主从自动切换、故障转移、拓扑管理。">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/web1.png">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/web2.png">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/web3_status.png">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/errant_gtid1.png">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/errant_gtid2.png">
<meta property="og:image" content="http://riverdba.github.io/2019/03/19/orchestrator/errant_gtid3.png">
<meta property="og:updated_time" content="2019-03-19T08:39:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL高可用探索之orchestrator">
<meta name="twitter:description" content="摘要：使用orchestrator实现mysql主从自动切换、故障转移、拓扑管理。">
<meta name="twitter:image" content="http://riverdba.github.io/2019/03/19/orchestrator/web1.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Yangtze River&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/yangtzeriver.jpg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>MySQL高可用探索之orchestrator | Yangtze River&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/yangtzeriver.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">一条大河</a></h1>
        </hgroup>

        
        <p class="header-subtitle">为学患无疑，疑则进也！</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:river_dba@foxmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDB/">GDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo-Quick-Start/">Hexo Quick Start</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL性能调优技术/">MySQL性能调优技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL查询优化技术/">MySQL查询优化技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-pt-kill/">Python+pt-kill</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL审核工具/">SQL审核工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/disqus/">disqus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/online-ddl/">online ddl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrapy/">scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite3/">sqlite3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sysbench/">sysbench</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作笔记/">工作笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/故障诊断/">故障诊断</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库恢复/">数据库恢复</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/yelee/">yelee主题</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://dbanote.github.io">刘雅君</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">一条大河</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/yangtzeriver.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">一条大河</a></h1>
            </hgroup>
            
            <p class="header-subtitle">为学患无疑，疑则进也！</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:river_dba@foxmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-orchestrator" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/03/19/orchestrator/" class="article-date">
      <time datetime="2019-03-19T07:43:11.000Z" itemprop="datePublished">2019-03-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MySQL高可用探索之orchestrator
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><excerpt in="" index="" |="" 首页摘要=""><br>摘要：使用orchestrator实现mysql主从自动切换、故障转移、拓扑管理。<a id="more"></a></excerpt></p>
<the rest="" of="" contents="" |="" 余下全文="">


<h3 id="部署MySQL环境-一主两从"><a href="#部署MySQL环境-一主两从" class="headerlink" title="部署MySQL环境(一主两从)"></a>部署MySQL环境(一主两从)</h3><table>
<thead>
<tr>
<th>IP:端口</th>
<th>角色</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.30.113:4406</td>
<td>master</td>
<td>Percona 5.7.24-27-log CentOS Linux release 7.4.1708 (Core) 3.10.0-693.el7.x86_64</td>
</tr>
<tr>
<td>192.168.30.118:4406</td>
<td>slave</td>
<td>Percona 5.7.24-27-log CentOS Linux release 7.4.1708 (Core) 3.10.0-693.el7.x86_64</td>
</tr>
<tr>
<td>192.168.30.119:4406</td>
<td>slave</td>
<td>Percona 5.7.24-27-log CentOS Linux release 7.4.1708 (Core) 3.10.0-693.el7.x86_64</td>
</tr>
</tbody>
</table>
<h4 id="安装MySQL-略"><a href="#安装MySQL-略" class="headerlink" title="安装MySQL(略)"></a>安装MySQL(略)</h4><h4 id="创建复制用户-三台mysql上面都创建"><a href="#创建复制用户-三台mysql上面都创建" class="headerlink" title="创建复制用户(三台mysql上面都创建)"></a>创建复制用户(三台mysql上面都创建)</h4><p>GRANT REPLICATION SLAVE ON <em>.</em> TO repluser@’192.168.30.%’ IDENTIFIED BY ‘rep_2019’;<br>set global slave_net_timeout=8; 缩短从库感知主库宕机的等待时间</p>
<h4 id="创建复制关系"><a href="#创建复制关系" class="headerlink" title="创建复制关系"></a>创建复制关系</h4><p>在118和119上执行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">change master to master_host=&apos;192.168.30.113&apos;,master_port=4406,master_user=&apos;repluser&apos;,master_password=&apos;rep_2019&apos;,master_auto_position=1,MASTER_HEARTBEAT_PERIOD=2,MASTER_CONNECT_RETRY=1, MASTER_RETRY_COUNT=86400;</div><div class="line">start slave;</div></pre></td></tr></table></figure></p>
<p>以119为例，实操：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mysql&gt; change master to master_host=&apos;192.168.30.113&apos;,master_port=4406,master_user=&apos;repluser&apos;,master_password=&apos;rep_2019&apos;,master_auto_position=1,MASTER_HEARTBEAT_PERIOD=2,MASTER_CONNECT_RETRY=1, MASTER_RETRY_COUNT=86400;</div><div class="line">Query OK, 0 rows affected, 2 warnings (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; show warnings \G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">  Level: Note</div><div class="line">   Code: 1759</div><div class="line">Message: Sending passwords in plain text without SSL/TLS is extremely insecure.</div><div class="line">*************************** 2. row ***************************</div><div class="line">  Level: Note</div><div class="line">   Code: 1760</div><div class="line">Message: Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the &apos;START SLAVE Syntax&apos; in the MySQL Manual for more information.</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">ERROR: </div><div class="line">No query specified</div><div class="line"></div><div class="line">mysql&gt; start slave;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; show slave status \G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State: Waiting for master to send event</div><div class="line">                  Master_Host: 192.168.30.113</div><div class="line">                  Master_User: repluser</div><div class="line">                  Master_Port: 4406</div><div class="line">                Connect_Retry: 1</div><div class="line">              Master_Log_File: mysql-bin.000024</div><div class="line">          Read_Master_Log_Pos: 588</div><div class="line">               Relay_Log_File: mysqld-relay-bin.000002</div><div class="line">                Relay_Log_Pos: 665</div><div class="line">        Relay_Master_Log_File: mysql-bin.000024</div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">              Replicate_Do_DB: </div><div class="line">          Replicate_Ignore_DB: </div><div class="line">           Replicate_Do_Table: </div><div class="line">       Replicate_Ignore_Table: </div><div class="line">      Replicate_Wild_Do_Table: </div><div class="line">  Replicate_Wild_Ignore_Table: </div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error: </div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 588</div><div class="line">              Relay_Log_Space: 873</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File: </div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File: </div><div class="line">           Master_SSL_CA_Path: </div><div class="line">              Master_SSL_Cert: </div><div class="line">            Master_SSL_Cipher: </div><div class="line">               Master_SSL_Key: </div><div class="line">        Seconds_Behind_Master: 0</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error: </div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error: </div><div class="line">  Replicate_Ignore_Server_Ids: </div><div class="line">             Master_Server_Id: 1134406</div><div class="line">                  Master_UUID: 9b8d01ee-081d-11e9-94a1-005056a99b7f</div><div class="line">             Master_Info_File: mysql.slave_master_info</div><div class="line">                    SQL_Delay: 0</div><div class="line">          SQL_Remaining_Delay: NULL</div><div class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</div><div class="line">           Master_Retry_Count: 86400</div><div class="line">                  Master_Bind: </div><div class="line">      Last_IO_Error_Timestamp: </div><div class="line">     Last_SQL_Error_Timestamp: </div><div class="line">               Master_SSL_Crl: </div><div class="line">           Master_SSL_Crlpath: </div><div class="line">           Retrieved_Gtid_Set: 9b8d01ee-081d-11e9-94a1-005056a99b7f:1</div><div class="line">            Executed_Gtid_Set: 3db33b36-0e51-409f-a61d-c99756e90155:1-31:1000007,</div><div class="line">7b8d01ee-081d-11e9-94a1-005056a99b7f:1-3,</div><div class="line">8b8d01ee-081d-11e9-94a1-005056a99b7f:1-2,</div><div class="line">9b8d01ee-081d-11e9-94a1-005056a99b7f:1</div><div class="line">                Auto_Position: 1</div><div class="line">         Replicate_Rewrite_DB: </div><div class="line">                 Channel_Name: </div><div class="line">           Master_TLS_Version: </div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">ERROR: </div><div class="line">No query specified</div></pre></td></tr></table></figure></p>
<p>在113上查看slave信息:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mysql&gt; show slave hosts;</div><div class="line">+-----------+----------------+------+-----------+--------------------------------------+</div><div class="line">| Server_id | Host           | Port | Master_id | Slave_UUID                           |</div><div class="line">+-----------+----------------+------+-----------+--------------------------------------+</div><div class="line">|   1194406 | 192.168.30.119 | 4406 |   1134406 | 8b8d01ee-081d-11e9-94a1-005056a99b7f |</div><div class="line">|   1184406 | 192.168.30.118 | 4406 |   1134406 | 7b8d01ee-081d-11e9-94a1-005056a99b7f |</div><div class="line">+-----------+----------------+------+-----------+--------------------------------------+</div><div class="line">2 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>一主两从搭建完毕。</p>
<h3 id="安装orchestrator"><a href="#安装orchestrator" class="headerlink" title="安装orchestrator"></a>安装orchestrator</h3><h4 id="下载并解压"><a href="#下载并解压" class="headerlink" title="下载并解压"></a>下载并解压</h4><p>下载地址：<a href="https://github.com/github/orchestrator/releases/download/v3.0.14/orchestrator-3.0.14-linux-amd64.tar.gz" target="_blank" rel="external">https://github.com/github/orchestrator/releases/download/v3.0.14/orchestrator-3.0.14-linux-amd64.tar.gz</a><br>将解压出来的orchestrator目录拷贝到/usr/local/，将/usr/local/orchestrator加入环境变量(3台都装)<br>[root@mysql2 src]# tar xvf orchestrator-3.0.14-linux-amd64.tar.gz<br>[root@mysql2 src]# cp -r ./usr/local/orchestrator/ /usr/local/</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>首先在orchestrator管理数据库的实例上创建账号：orch自用<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">root@(none) 04:11:09&gt;create database orchestrator;</div><div class="line">Query OK, 1 row affected (0.02 sec)</div><div class="line">root@(none) 04:13:49&gt;CREATE USER &apos;orchestrator&apos;@&apos;192.168.1.3&apos; IDENTIFIED BY &apos;123456&apos;;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">root@(none) 04:13:58&gt;GRANT ALL ON orchestrator.* TO &apos;orchestrator&apos;@&apos;192.168.1.3&apos;; </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>然后再在被管理的MySQL实例上创建账号（只在主库113执行即可，从库会复制过去）：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mysql&gt; GRANT SELECT, RELOAD, PROCESS, SUPER, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;orchestrator&apos;@&apos;192.168.30.%&apos; identified by &apos;abc123&apos;;</div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; show warnings;</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">| Level   | Code | Message                                                                                                                                                                            |</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">| Warning | 1287 | Using GRANT statement to modify existing user&apos;s properties other than privileges is deprecated and will be removed in future release. Use ALTER USER statement for this operation. |</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>编辑配置文件<br><a href="https://github.com/github/orchestrator/blob/master/docs/configuration-sample.md" target="_blank" rel="external">https://github.com/github/orchestrator/blob/master/docs/configuration-sample.md</a><br>使用官网的配置文件模板，修改一下数据源即可：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-113 ~]# cat /usr/local/orchestrator/orchestrator.conf.json </div><div class="line">&#123;</div><div class="line">  &quot;Debug&quot;: true,</div><div class="line">  &quot;EnableSyslog&quot;: false,</div><div class="line">  &quot;ListenAddress&quot;: &quot;:3000&quot;,</div><div class="line">  &quot;MySQLTopologyUser&quot;: &quot;orchestrator&quot;,</div><div class="line">  &quot;MySQLTopologyPassword&quot;: &quot;abc123&quot;,</div><div class="line">  &quot;MySQLTopologyCredentialsConfigFile&quot;: &quot;&quot;,</div><div class="line">  &quot;MySQLTopologySSLPrivateKeyFile&quot;: &quot;&quot;,</div><div class="line">  &quot;MySQLTopologySSLCertFile&quot;: &quot;&quot;,</div><div class="line">  &quot;MySQLTopologySSLCAFile&quot;: &quot;&quot;,</div><div class="line">  &quot;MySQLTopologySSLSkipVerify&quot;: true,</div><div class="line">  &quot;MySQLTopologyUseMutualTLS&quot;: false,</div><div class="line">  &quot;MySQLOrchestratorHost&quot;: &quot;192.168.1.3&quot;,</div><div class="line">  &quot;MySQLOrchestratorPort&quot;: 3306,</div><div class="line">  &quot;MySQLOrchestratorDatabase&quot;: &quot;orchestrator&quot;,</div><div class="line">  &quot;MySQLOrchestratorUser&quot;: &quot;orchestrator&quot;,</div><div class="line">  &quot;MySQLOrchestratorPassword&quot;: &quot;123456&quot;,</div><div class="line">  ... ...</div><div class="line">  &quot;RaftEnabled&quot;: true,</div><div class="line">  &quot;BackendDB&quot;: &quot;mysql&quot;,</div><div class="line">  &quot;RaftBind&quot;: &quot;192.168.30.113&quot;,</div><div class="line">  &quot;RaftDataDir&quot;: &quot;/var/lib/orchestrator&quot;,</div><div class="line">  &quot;DefaultRaftPort&quot;: 10008,</div><div class="line">  &quot;RaftNodes&quot;: [</div><div class="line">    &quot;192.168.30.113&quot;,</div><div class="line">    &quot;192.168.30.118&quot;,</div><div class="line">    &quot;192.168.30.119&quot;</div><div class="line">    ],</div><div class="line"> &quot;ConsulAddress&quot;: &quot;&quot;,</div><div class="line"> &quot;ConsulAclToken&quot;: &quot;&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">root@:mysql-113:/usr/local/orchestrator$./orchestrator --config=./orchestrator.conf.json http</div><div class="line">2019-02-26 16:21:50 INFO starting orchestrator</div><div class="line">2019-02-26 16:21:50 INFO Read config: ./orchestrator.conf.json</div><div class="line">2019-02-26 16:21:50 DEBUG Initializing orchestrator</div><div class="line">2019-02-26 16:21:50 DEBUG Migrating database schema</div><div class="line">2019-02-26 16:22:25 DEBUG Migrated database schema to version [1.5.7]</div><div class="line">2019-02-26 16:22:25 DEBUG Connected to orchestrator backend: orchestrator:?@tcp(127.0.0.1:3306)/orchestrator?timeout=1s</div><div class="line">2019-02-26 16:22:25 DEBUG Orchestrator pool SetMaxOpenConns: 128</div><div class="line">2019-02-26 16:22:25 INFO Starting Discovery</div><div class="line">2019-02-26 16:22:25 INFO Registering endpoints</div><div class="line">2019-02-26 16:22:25 INFO Starting continuous discovery</div><div class="line">2019-02-26 16:22:25 INFO Starting HTTP listener on :3000</div><div class="line">2019-02-26 16:22:26 DEBUG outdated keys: []</div><div class="line">2019-02-26 16:22:27 DEBUG outdated keys: []</div><div class="line">2019-02-26 16:22:28 DEBUG outdated keys: []</div><div class="line">2019-02-26 16:22:29 DEBUG outdated keys: []</div><div class="line">2019-02-26 16:22:30 DEBUG outdated keys: []</div><div class="line">2019-02-26 16:22:31 DEBUG outdated keys: []</div></pre></td></tr></table></figure>
<h4 id="访问WEB"><a href="#访问WEB" class="headerlink" title="访问WEB"></a>访问WEB</h4><p><a href="http://192.168.30.113:3000" target="_blank" rel="external">http://192.168.30.113:3000</a><br><img src="/2019/03/19/orchestrator/web1.png" alt="web1"><br><img src="/2019/03/19/orchestrator/web2.png" alt="web2"><br><img src="/2019/03/19/orchestrator/web3_status.png" alt="web3"></p>
<h3 id="命令行操作"><a href="#命令行操作" class="headerlink" title="命令行操作"></a>命令行操作</h3><p>将/usr/local/orchestrator/resources/bin目录加入path环境变量</p>
<h4 id="列出集群（含别名）"><a href="#列出集群（含别名）" class="headerlink" title="列出集群（含别名）"></a>列出集群（含别名）</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c clusters-alias</div><div class="line">mysql-113:4406,cluster_dev</div><div class="line">mysql2:3306,trotdb_test</div></pre></td></tr></table></figure>
<h4 id="发现实例"><a href="#发现实例" class="headerlink" title="发现实例"></a>发现实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119]# orchestrator -c discover -i mysql1:3306  </div><div class="line">2019-03-11 07:12:45 FATAL Orchestrator configured to run raft (&quot;RaftEnabled&quot;: true). All access must go through the web API of the active raft node. You may use the orchestrator-client script which has a similar interface to the command line invocation. You may override this with --ignore-raft-setup</div><div class="line">报错说在启用raft模式上禁止使用orchestrator客户端，建议使用orchestrator-client，orchestrator-client可以安装在没有orchestrator上的服务器。</div><div class="line">要使用orchestrator-client需要先安装jq，否则会报错：orchestrator-client[18537]: cannot find jq</div><div class="line">[root@mysql-119]# yum install jq -y</div><div class="line">[root@mysql-119]# orchestrator-client -c discover -i mysql1:3306</div><div class="line">mysql1:3306</div></pre></td></tr></table></figure>
<h4 id="查看拓扑"><a href="#查看拓扑" class="headerlink" title="查看拓扑"></a>查看拓扑</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c topology -i mysql-113:4406</div><div class="line">mysql-113:4406     [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div><div class="line">+ mysql-119:4406   [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div><div class="line">  + mysql-118:4406 [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID]</div><div class="line">[root@mysql-119 ~]# </div><div class="line">返回列表格式：</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c topology-tabulated -i mysql-113:4406</div><div class="line">mysql-113:4406    |0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">+ mysql-119:4406  |0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">  + mysql-118:4406|0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID</div></pre></td></tr></table></figure>
<h4 id="忘记实例"><a href="#忘记实例" class="headerlink" title="忘记实例"></a>忘记实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c forget -i mysql-118:4406</div><div class="line">查看拓扑可以发现没有了mysql-118:</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c topology-tabulated -i mysql-113:4406</div><div class="line">mysql-113:4406  |0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">+ mysql-119:4406|0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">重新发现mysql-118：</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c discover -i mysql-118:4406                  </div><div class="line">mysql-118:4406</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c topology-tabulated -i mysql-113:4406</div><div class="line">mysql-113:4406    |0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">+ mysql-119:4406  |0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID,P-GTID</div><div class="line">  + mysql-118:4406|0s|ok|5.7.24-27-log|rw|ROW|&gt;&gt;,GTID</div></pre></td></tr></table></figure>
<h4 id="查看API接口"><a href="#查看API接口" class="headerlink" title="查看API接口"></a>查看API接口</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c which-api</div><div class="line">http://localhost:3000/api</div></pre></td></tr></table></figure>
<h4 id="调用API"><a href="#调用API" class="headerlink" title="调用API"></a>调用API</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c api -path clusters</div><div class="line">[ &quot;mysql-113:4406&quot;, &quot;mysql2:3306&quot; ]</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c api -path leader-check</div><div class="line">&quot;Not leader&quot;</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c api -path status</div><div class="line">&#123; &quot;Code&quot;: &quot;OK&quot;, &quot;Message&quot;: &quot;Application node is healthy&quot;, &quot;Details&quot;: &#123; &quot;Healthy&quot;: true, &quot;Hostname&quot;: &quot;mysql-119&quot;, &quot;Token&quot;: &quot;3bfe4deae671a528477bb3caa281b4d50b7aae33b052dd421d2b8655c8220864&quot;, &quot;IsActiveNode&quot;: false, &quot;ActiveNode&quot;: &#123; &quot;Hostname&quot;: &quot;192.168.30.118:10008&quot;, &quot;Token&quot;: &quot;&quot;, &quot;AppVersion&quot;: &quot;&quot;, &quot;FirstSeenActive&quot;: &quot;&quot;, &quot;LastSeenActive&quot;: &quot;&quot;, &quot;ExtraInfo&quot;: &quot;&quot;, &quot;Command&quot;: &quot;&quot;, &quot;DBBackend&quot;: &quot;&quot;, &quot;LastReported&quot;: &quot;0001-01-01T00:00:00Z&quot; &#125;, &quot;Error&quot;: null, &quot;AvailableNodes&quot;: [ &#123; &quot;Hostname&quot;: &quot;mysql-113&quot;, &quot;Token&quot;: &quot;30a4dc2ab18b3fce1f66b518a3c87f5f8c9351bcf43e09e10718390392bb64aa&quot;, &quot;AppVersion&quot;: &quot;3.0.14&quot;, &quot;FirstSeenActive&quot;: &quot;2019-03-05 14:04:02&quot;, &quot;LastSeenActive&quot;: &quot;2019-03-11 19:36:14&quot;, &quot;ExtraInfo&quot;: &quot;&quot;, &quot;Command&quot;: &quot;&quot;, &quot;DBBackend&quot;: &quot;192.168.1.3:3306&quot;, &quot;LastReported&quot;: &quot;0001-01-01T00:00:00Z&quot; &#125;, &#123; &quot;Hostname&quot;: &quot;mysql-118&quot;, &quot;Token&quot;: &quot;b8e7dea2b6bf2a7117f0ba6258633f7ad677675530d499462d51473bffd6e54b&quot;, &quot;AppVersion&quot;: &quot;3.0.14&quot;, &quot;FirstSeenActive&quot;: &quot;2019-03-05 13:58:53&quot;, &quot;LastSeenActive&quot;: &quot;2019-03-11 19:36:13&quot;, &quot;ExtraInfo&quot;: &quot;&quot;, &quot;Command&quot;: &quot;&quot;, &quot;DBBackend&quot;: &quot;192.168.1.3:3306&quot;, &quot;LastReported&quot;: &quot;0001-01-01T00:00:00Z&quot; &#125;, &#123; &quot;Hostname&quot;: &quot;mysql-119&quot;, &quot;Token&quot;: &quot;3bfe4deae671a528477bb3caa281b4d50b7aae33b052dd421d2b8655c8220864&quot;, &quot;AppVersion&quot;: &quot;3.0.14&quot;, &quot;FirstSeenActive&quot;: &quot;2019-03-05 14:01:55&quot;, &quot;LastSeenActive&quot;: &quot;2019-03-11 19:36:14&quot;, &quot;ExtraInfo&quot;: &quot;&quot;, &quot;Command&quot;: &quot;&quot;, &quot;DBBackend&quot;: &quot;192.168.1.3:3306&quot;, &quot;LastReported&quot;: &quot;0001-01-01T00:00:00Z&quot; &#125; ], &quot;RaftLeader&quot;: &quot;192.168.30.118:10008&quot;, &quot;IsRaftLeader&quot;: false, &quot;RaftLeaderURI&quot;: &quot;http://192.168.30.118:3000&quot;, &quot;RaftAdvertise&quot;: &quot;192.168.30.119&quot;, &quot;RaftHealthyMembers&quot;: null &#125; &#125;</div><div class="line">[root@mysql-118 ~]# orchestrator-client -c api -path leader-check</div><div class="line">&quot;OK&quot;</div><div class="line">[root@mysql-113 ~]# orchestrator-client -c api -path leader-check</div><div class="line">&quot;Not leader&quot;</div></pre></td></tr></table></figure>
<h4 id="搜索实例"><a href="#搜索实例" class="headerlink" title="搜索实例"></a>搜索实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c search -i mysql-118</div><div class="line">mysql-118:4406</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c search -i mysql3</div><div class="line">mysql3:3307</div></pre></td></tr></table></figure>
<h4 id="查看指定实例的主库"><a href="#查看指定实例的主库" class="headerlink" title="查看指定实例的主库"></a>查看指定实例的主库</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c which-master -i mysql-119:4406</div><div class="line">mysql-113:4406</div></pre></td></tr></table></figure>
<h4 id="查看指定实例的从库"><a href="#查看指定实例的从库" class="headerlink" title="查看指定实例的从库"></a>查看指定实例的从库</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c which-replicas -i mysql-113:4406</div><div class="line">mysql-119:4406</div><div class="line">[root@mysql-119 ~]# orchestrator-client -c which-replicas -i mysql2</div><div class="line">mysql1:3306</div><div class="line">mysql3:3307</div></pre></td></tr></table></figure>
<h4 id="查看指定实例名"><a href="#查看指定实例名" class="headerlink" title="查看指定实例名"></a>查看指定实例名</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]# orchestrator-client -c instance -i mysql2                  </div><div class="line">mysql2:3306</div></pre></td></tr></table></figure>
<h4 id="打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常："><a href="#打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常：" class="headerlink" title="打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常："></a>打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># orchestrator-client -c which-broken-replicas -i test2:3307</div><div class="line">test3:3307</div></pre></td></tr></table></figure>
<h4 id="给定一个实例，列出所在集群下所有实例"><a href="#给定一个实例，列出所在集群下所有实例" class="headerlink" title="给定一个实例，列出所在集群下所有实例"></a>给定一个实例，列出所在集群下所有实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c which-cluster-instances -i mysql-119:4406        </div><div class="line">mysql-113:4406</div><div class="line">mysql-118:4406</div><div class="line">mysql-119:4406</div><div class="line">[root@mysql-119 ~]#  orchestrator-client -c which-cluster-instances -i mysql1</div><div class="line">mysql1:3306</div><div class="line">mysql2:3306</div><div class="line">mysql3:3307</div></pre></td></tr></table></figure>
<h4 id="查看所有实例"><a href="#查看所有实例" class="headerlink" title="查看所有实例"></a>查看所有实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c all-clusters-masters  </div><div class="line">mysql-113:4406</div><div class="line">mysql2:3306</div><div class="line">[root@mysql-119 ~]#  orchestrator-client -c all-instances         </div><div class="line">mysql2:3306</div><div class="line">mysql-113:4406</div><div class="line">mysql-119:4406</div><div class="line">mysql1:3306</div><div class="line">mysql3:3307</div><div class="line">mysql-118:4406</div></pre></td></tr></table></figure>
<h4 id="查看可作为pt-online-schema-change操作的副本列表"><a href="#查看可作为pt-online-schema-change操作的副本列表" class="headerlink" title="查看可作为pt-online-schema-change操作的副本列表"></a>查看可作为pt-online-schema-change操作的副本列表</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c which-cluster-osc-replicas -i mysql2</div><div class="line">mysql1:3306</div><div class="line">mysql3:3307</div><div class="line">[root@mysql-119 ~]#  orchestrator-client -c which-cluster-osc-running-replicas -i mysql2</div><div class="line">mysql1:3306</div><div class="line">mysql3:3307</div></pre></td></tr></table></figure>
<h4 id="查看集群中主实例的数据中心"><a href="#查看集群中主实例的数据中心" class="headerlink" title="查看集群中主实例的数据中心"></a>查看集群中主实例的数据中心</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c dominant-dc</div><div class="line">mysql2</div></pre></td></tr></table></figure>
<h4 id="将集群的主提交到KV存储"><a href="#将集群的主提交到KV存储" class="headerlink" title="将集群的主提交到KV存储"></a>将集群的主提交到KV存储</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c submit-masters-to-kv-stores</div><div class="line">mysql/master/cluster_dev:mysql-113:4406</div><div class="line">mysql/master/cluster_dev/hostname:mysql-113</div><div class="line">mysql/master/cluster_dev/port:4406</div><div class="line">mysql/master/cluster_dev/ipv4:192.168.30.113</div><div class="line">mysql/master/cluster_dev/ipv6:</div><div class="line">mysql/master/trotdb_test:mysql2:3306</div><div class="line">mysql/master/trotdb_test/hostname:mysql2</div><div class="line">mysql/master/trotdb_test/port:3306</div><div class="line">mysql/master/trotdb_test/ipv4:192.168.1.173</div><div class="line">mysql/master/trotdb_test/ipv6:</div></pre></td></tr></table></figure>
<h4 id="修改拓扑（迁移从库到另一个实例上）"><a href="#修改拓扑（迁移从库到另一个实例上）" class="headerlink" title="修改拓扑（迁移从库到另一个实例上）"></a>修改拓扑（迁移从库到另一个实例上）</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-119 ~]#  orchestrator-client -c topology -i mysql-118:4406                  </div><div class="line">mysql-113:4406     [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div><div class="line">+ mysql-119:4406   [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div><div class="line">  + mysql-118:4406 [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID]</div><div class="line">将mysql-118:4406改为mysql-113:4406的从库</div><div class="line">[root@mysql-119 ~]#  orchestrator-client -c relocate -i mysql-118:4406 -d mysql-113:4406</div><div class="line">mysql-118:4406&lt;mysql-113:4406</div><div class="line">[root@mysql-119 ~]#  orchestrator-client -c topology -i mysql-118:4406                  </div><div class="line">mysql-113:4406   [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div><div class="line">+ mysql-118:4406 [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID]</div><div class="line">+ mysql-119:4406 [0s,ok,5.7.24-27-log,rw,ROW,&gt;&gt;,GTID,P-GTID]</div></pre></td></tr></table></figure>
<p>如果发生过了failover，旧主修复后只能通过手动方式将其加入复制。<br>如果使用orchestrator加入会报错：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql-113 ~]# orchestrator-client -c relocate -i mysql-118:4406 -d mysql-113:4406</div><div class="line">2019-03-19 08:37:10 ERROR Relocating mysql-118:4406 below mysql-113:4406 turns to be too complex; please do it manually</div></pre></td></tr></table></figure></p>
<h3 id="故障切换"><a href="#故障切换" class="headerlink" title="故障切换"></a>故障切换</h3><h4 id="主库宕机，自动Failover"><a href="#主库宕机，自动Failover" class="headerlink" title="主库宕机，自动Failover"></a>主库宕机，自动Failover</h4><p>②  Detected UnreachableMaster on mysql-113:4406. Affected replicas: 2<br>②  Detected DeadMaster on mysql-113:4406. Affected replicas: 1<br>③  Will recover from DeadMaster on mysql-113:4406<br>④  Recovered from DeadMaster on mysql-113:4406. Failed: mysql-113:4406; Promoted: mysql-118:4406<br>⑤  (for all types) Recovered from DeadMaster on mysql-113:4406. Failed: mysql-113:4406; Successor: mysql-118:4406</p>
<h3 id="遇到问题及解决"><a href="#遇到问题及解决" class="headerlink" title="遇到问题及解决"></a>遇到问题及解决</h3><h4 id="访问WEB报：html-template-“templates-layout”-is-undefined"><a href="#访问WEB报：html-template-“templates-layout”-is-undefined" class="headerlink" title="访问WEB报：html/template: “templates/layout” is undefined"></a>访问WEB报：html/template: “templates/layout” is undefined</h4><p>访问<a href="http://192.168.30.113:3000时报错：html/template" target="_blank" rel="external">http://192.168.30.113:3000时报错：html/template</a>: “templates/layout” is undefined<br>由于启动orchstrator时没有cd到go的项目路径，而是直接使用绝对路径启动：<br>/usr/local/orchestrator/orchestrator –config=/usr/local/orchestrator/orchestrator.conf.json http &amp;<br>正确启动方式：<br>cd /usr/local/orchestrator &amp;&amp; ./orchestrator –config=./orchestrator.conf.json http &amp; </p>
<h4 id="glibc版本太低问题"><a href="#glibc版本太低问题" class="headerlink" title="glibc版本太低问题"></a>glibc版本太低问题</h4><p>如果系统版本是centos6，运行时可能遇到如下报错：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@mysql2 ~]# orchestrator </div><div class="line">orchestrator: /lib64/libc.so.6: version `GLIBC_2.14&apos; not found (required by orchestrator)</div><div class="line">[root@mysql2 ~]# strings /lib64/libc.so.6 |grep GLIBC</div><div class="line">GLIBC_2.2.5</div><div class="line">GLIBC_2.2.6</div><div class="line">GLIBC_2.3</div><div class="line">GLIBC_2.3.2</div><div class="line">GLIBC_2.3.3</div><div class="line">GLIBC_2.3.4</div><div class="line">GLIBC_2.4</div><div class="line">GLIBC_2.5</div><div class="line">GLIBC_2.6</div><div class="line">GLIBC_2.7</div><div class="line">GLIBC_2.8</div><div class="line">GLIBC_2.9</div><div class="line">GLIBC_2.10</div><div class="line">GLIBC_2.11</div><div class="line">GLIBC_2.12</div><div class="line">GLIBC_PRIVATE</div><div class="line">[root@mysql2 ~]# </div><div class="line">升级glibc要非常小心，一般不建议升级。</div><div class="line">root@:mysql_dev:~$strings /lib64/libc.so.6 |grep GLIBC</div><div class="line">GLIBC_2.2.5</div><div class="line">GLIBC_2.2.6</div><div class="line">GLIBC_2.3</div><div class="line">GLIBC_2.3.2</div><div class="line">GLIBC_2.3.3</div><div class="line">GLIBC_2.3.4</div><div class="line">GLIBC_2.4</div><div class="line">GLIBC_2.5</div><div class="line">GLIBC_2.6</div><div class="line">GLIBC_2.7</div><div class="line">GLIBC_2.8</div><div class="line">GLIBC_2.9</div><div class="line">GLIBC_2.10</div><div class="line">GLIBC_2.11</div><div class="line">GLIBC_2.12</div><div class="line">GLIBC_2.13</div><div class="line">GLIBC_2.14</div><div class="line">GLIBC_2.15</div><div class="line">GLIBC_2.16</div><div class="line">GLIBC_2.17</div><div class="line">GLIBC_PRIVATE</div><div class="line">root@:mysql_dev:~$orchestrator --help                 </div><div class="line">Usage of orchestrator:</div><div class="line">  -alias string</div><div class="line">        cluster alias</div><div class="line">  -binlog string</div><div class="line">        Binary log file name</div><div class="line">  -c string</div><div class="line">        command, required. See full list of commands via &apos;orchestrator -c help&apos;</div><div class="line">  -config string</div><div class="line">        config file name</div><div class="line">  -d string</div><div class="line">        destination instance, host_fqdn[:port] (synonym to -s)</div><div class="line">  -databaseless</div><div class="line">        EXPERIMENTAL! Work without backend database</div><div class="line">  -debug</div><div class="line">        debug mode (very verbose)</div><div class="line">  -discovery</div><div class="line">        auto discovery mode (default true)</div><div class="line">  -duration string</div><div class="line">        maintenance duration (format: 59s, 59m, 23h, 6d, 4w)</div><div class="line">  -grab-election</div><div class="line">        Grab leadership (only applies to continuous mode)</div><div class="line">  -hostname string</div><div class="line">        Hostname/fqdn/CNAME/VIP (applies for hostname/resolve related commands)</div><div class="line">  -i string</div><div class="line">        instance, host_fqdn[:port] (e.g. db.company.com:3306, db.company.com)</div><div class="line">  -noop</div><div class="line">        Dry run; do not perform destructing operations</div><div class="line">  -owner string</div><div class="line">        operation owner</div><div class="line">  -pattern string</div><div class="line">        regular expression pattern</div><div class="line">  -pool string</div><div class="line">        Pool logical name (applies for pool-related commands)</div><div class="line">  -promotion-rule string</div><div class="line">        Promotion rule for register-andidate (prefer|neutral|must_not) (default &quot;prefer&quot;)</div><div class="line">  -quiet</div><div class="line">        quiet</div><div class="line">  -reason string</div><div class="line">        operation reason</div><div class="line">  -s string</div><div class="line">        sibling instance, host_fqdn[:port]</div><div class="line">  -skip-unresolve</div><div class="line">        Do not unresolve a host name</div><div class="line">  -skip-unresolve-check</div><div class="line">        Skip/ignore checking an unresolve mapping (via hostname_unresolve table) resolves back to same hostname</div><div class="line">  -stack</div><div class="line">        add stack trace upon error</div><div class="line">  -statement string</div><div class="line">        Statement/hint</div><div class="line">  -strict</div><div class="line">        strict mode (more checks, slower)</div><div class="line">  -verbose</div><div class="line">        verbose</div><div class="line">  -version</div><div class="line">        Print version and exit</div></pre></td></tr></table></figure></p>
<h4 id="虚GTID问题"><a href="#虚GTID问题" class="headerlink" title="虚GTID问题"></a>虚GTID问题</h4><p>报错：2019-03-05 10:31:52 ERROR ReadTopologyInstance(mysql-113:4406) DetectPseudoGTIDQuery: Error 1146: Table ‘meta.pseudo_gtid_status’ doesn’t exist<br>在被管理的MySQL实例上创建Pseudo-GTID的meta库（只在主库执行即可，从库会复制过去）<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mysql&gt; create database meta;</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; source /usr/local/orchestrator/resources/pseudo-gtid/pseudo-gtid.sql;</div><div class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">Database changed</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; CREATE TABLE IF NOT EXISTS cluster (</div><div class="line">    -&gt;    anchor TINYINT NOT NULL,</div><div class="line">    -&gt;    cluster_name VARCHAR(128) CHARSET ascii NOT NULL DEFAULT &apos;&apos;,</div><div class="line">    -&gt;    cluster_domain VARCHAR(128) CHARSET ascii NOT NULL DEFAULT &apos;&apos;,</div><div class="line">    -&gt;    PRIMARY KEY (anchor)</div><div class="line">    -&gt;  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; show tables;</div><div class="line">+--------------------+</div><div class="line">| Tables_in_meta     |</div><div class="line">+--------------------+</div><div class="line">| cluster            |</div><div class="line">| pseudo_gtid_status |</div><div class="line">+--------------------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; INSERT INTO cluster (anchor, cluster_name, cluster_domain) </div><div class="line">    -&gt; VALUES (1, CONCAT(&apos;cls_&apos;,@@hostname), @@hostname) </div><div class="line">    -&gt; ON DUPLICATE KEY UPDATE cluster_name=VALUES(cluster_name), cluster_domain=VALUES(cluster_domain);</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from cluster;</div><div class="line">+--------+---------------+----------------+</div><div class="line">| anchor | cluster_name  | cluster_domain |</div><div class="line">+--------+---------------+----------------+</div><div class="line">|      1 | cls_mysql-113 | mysql-113      |</div><div class="line">+--------+---------------+----------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<h4 id="hosts没配置报错"><a href="#hosts没配置报错" class="headerlink" title="hosts没配置报错"></a>hosts没配置报错</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">2019-02-27 11:28:43 DEBUG outdated keys: []</div><div class="line">2019-02-27 11:28:44 DEBUG outdated keys: [mysql1:3306 mysql2:3306 mysql3:3307]</div><div class="line">2019-02-27 11:28:44 ERROR dial tcp: lookup mysql3 on [::1]:53: read udp [::1]:32462-&gt;[::1]:53: read: connection refused</div><div class="line">2019-02-27 11:28:44 ERROR ReadTopologyInstance(mysql3:3307) show variables like &apos;maxscale%&apos;: dial tcp: lookup mysql3 on [::1]:53: read udp [::1]:32462-&gt;[::1]:53: read: connection refused</div><div class="line">2019-02-27 11:28:44 ERROR ReadTopologyInstance(mysql3:3307) Cleanup: dial tcp: lookup mysql3 on [::1]:53: read udp [::1]:19871-&gt;[::1]:53: read: connection refused</div><div class="line">2019-02-27 11:28:44 WARNING discoverInstance(mysql3:3307) instance is nil in 0.009s, error=Failed ReadTopologyInstance</div><div class="line">2019-02-27 11:28:44 DEBUG Discovered host: mysql2:3306, master: mysql1:3306, version: 5.7.20-19-log in 0.018s</div><div class="line">2019-02-27 11:28:44 DEBUG Discovered host: mysql1:3306, master: mysql2:3306, version: 5.7.20-19-log in 0.020s</div><div class="line">2019-02-27 11:28:45 DEBUG outdated keys: []</div><div class="line">报错：</div><div class="line">2019-03-05 13:31:04 DEBUG raft leader is 192.168.30.113:10008; state: Follower</div><div class="line">2019-03-05 13:31:07 ERROR ReadTopologyInstance(mysql1:3306) show global status like &apos;Uptime&apos;: dial tcp: lookup mysql1 on 127.0.0.1:53: no such host</div><div class="line">2019-03-05 13:31:07 ERROR ReadTopologyInstance(mysql3:3307) show global status like &apos;Uptime&apos;: dial tcp: lookup mysql3 on 127.0.0.1:53: no such host</div><div class="line">原因：域名解析问题，配置/etc/hosts解决</div><div class="line">解决：在orchestrator运行的机器上添加mysql的ip及对应主机名</div><div class="line">#orchestrator</div><div class="line">192.168.1.172 mysql1</div><div class="line">192.168.1.173 mysql2</div><div class="line">192.168.1.123 mysql3</div></pre></td></tr></table></figure>
<h4 id="report-host没设置报错"><a href="#report-host没设置报错" class="headerlink" title="report-host没设置报错"></a>report-host没设置报错</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">2019-02-26 17:15:03 DEBUG outdated keys: [mysql1:3306 mysql2:3306]</div><div class="line">2019-02-26 17:15:03 ERROR ReadTopologyInstance(mysql2:3306) show slave hosts: ReadTopologyInstance(mysql2:3306) &apos;show slave hosts&apos; returned row with &lt;host,port&gt;: &lt;,3306&gt;</div><div class="line">2019-02-26 17:15:03 ERROR ReadTopologyInstance(mysql1:3306) show slave hosts: ReadTopologyInstance(mysql1:3306) &apos;show slave hosts&apos; returned row with &lt;host,port&gt;: &lt;,3306&gt;</div><div class="line">2019-02-26 17:15:03 DEBUG Discovered host: mysql2:3306, master: mysql1:3306, version: 5.7.20-19-log in 0.018s</div><div class="line">2019-02-26 17:15:03 DEBUG Discovered host: mysql1:3306, master: mysql2:3306, version: 5.7.20-19-log in 0.025s</div><div class="line">2019-02-26 17:15:04 DEBUG outdated keys: []</div><div class="line">2019-02-26 17:15:05 DEBUG outdated keys: []</div><div class="line">解决：</div><div class="line">Mysql主从复制，在master上查看从的信息：show slave hosts</div><div class="line">http://dinglin.iteye.com/blog/1255160 </div><div class="line">默认不记录从的host信息，只记录端口和Server_id信息，需要设置my.cnf 中的[mysqld] report-host=IP</div><div class="line"></div><div class="line">正常输出：</div><div class="line">2019-02-27 11:31:43 DEBUG outdated keys: []</div><div class="line">2019-02-27 11:31:44 DEBUG outdated keys: [mysql1:3306 mysql2:3306 mysql3:3307]</div><div class="line">2019-02-27 11:31:44 DEBUG Discovered host: mysql2:3306, master: mysql1:3306, version: 5.7.20-19-log in 0.019s</div><div class="line">2019-02-27 11:31:44 DEBUG Discovered host: mysql1:3306, master: mysql2:3306, version: 5.7.20-19-log in 0.023s</div><div class="line">2019-02-27 11:31:44 DEBUG Discovered host: mysql3:3307, master: mysql2:3306, version: 5.7.20-19-log in 0.042s</div><div class="line">2019-02-27 11:31:45 DEBUG outdated keys: []</div></pre></td></tr></table></figure>
<h4 id="mysql用户权限问题"><a href="#mysql用户权限问题" class="headerlink" title="mysql用户权限问题"></a>mysql用户权限问题</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">2019-03-05 13:58:55 ERROR ReadTopologyInstance(mysql2:3306) show global status like &apos;Uptime&apos;: Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:34 ERROR ReadTopologyInstance(mysql3:3307) show global status like &apos;Uptime&apos;: Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:34 WARNING  DiscoverInstance(mysql3:3307) instance is nil in 0.017s (Backend: 0.004s, Instance: 0.013s), error=Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:34 ERROR ReadTopologyInstance(mysql1:3306) show global status like &apos;Uptime&apos;: Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:34 WARNING  DiscoverInstance(mysql1:3306) instance is nil in 0.023s (Backend: 0.004s, Instance: 0.019s), error=Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:35 ERROR ReadTopologyInstance(mysql2:3306) show global status like &apos;Uptime&apos;: Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">2019-03-05 14:08:35 WARNING  DiscoverInstance(mysql2:3306) instance is nil in 0.016s (Backend: 0.008s, Instance: 0.009s), error=Error 1045: Access denied for user &apos;orchestrator&apos;@&apos;192.168.30.118&apos; (using password: YES)</div><div class="line">解决：由于orchestrator部署到了新的网段，需重新赋权</div><div class="line">mysql&gt; GRANT SELECT, RELOAD, PROCESS, SUPER, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;orchestrator&apos;@&apos;192.168.30.%&apos; identified by &apos;abc123&apos;;</div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; show warnings;</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">| Level   | Code | Message                                                                                                                                                                            |</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">| Warning | 1287 | Using GRANT statement to modify existing user&apos;s properties other than privileges is deprecated and will be removed in future release. Use ALTER USER statement for this operation. |</div><div class="line">+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<h4 id="GTID错误跳过"><a href="#GTID错误跳过" class="headerlink" title="GTID错误跳过"></a>GTID错误跳过</h4><p>Problem:Errant GTID<br>replica has gtid entries not found on its master<br>可以在页面上处理GTID错误：<br><img src="/2019/03/19/orchestrator/errant_gtid1.png" alt="图1"><br><img src="/2019/03/19/orchestrator/errant_gtid2.png" alt="图2"><br><img src="/2019/03/19/orchestrator/errant_gtid3.png" alt="图3"><br>然后刷新下页面就没有GTID的报错了。</p>
</the>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/03/19/orchestrator/">MySQL高可用探索之orchestrator</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">一条大河</a></p>
        <p><span>发布时间:</span>2019-03-19, 15:43:11</p>
        <p><span>最后更新:</span>2019-03-19, 16:39:30</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/03/19/orchestrator/" title="MySQL高可用探索之orchestrator">http://riverdba.github.io/2019/03/19/orchestrator/</a>
            <span class="copy-path" data-clipboard-text="原文: http://riverdba.github.io/2019/03/19/orchestrator/　　作者: 一条大河" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/03/18/strace-mysql/">
                    使用strace跟踪mysql的运行
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署MySQL环境-一主两从"><span class="toc-number">1.</span> <span class="toc-text">部署MySQL环境(一主两从)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装MySQL-略"><span class="toc-number">1.1.</span> <span class="toc-text">安装MySQL(略)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建复制用户-三台mysql上面都创建"><span class="toc-number">1.2.</span> <span class="toc-text">创建复制用户(三台mysql上面都创建)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建复制关系"><span class="toc-number">1.3.</span> <span class="toc-text">创建复制关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装orchestrator"><span class="toc-number">2.</span> <span class="toc-text">安装orchestrator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载并解压"><span class="toc-number">2.1.</span> <span class="toc-text">下载并解压</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-number">2.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动"><span class="toc-number">2.3.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问WEB"><span class="toc-number">2.4.</span> <span class="toc-text">访问WEB</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令行操作"><span class="toc-number">3.</span> <span class="toc-text">命令行操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#列出集群（含别名）"><span class="toc-number">3.1.</span> <span class="toc-text">列出集群（含别名）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#发现实例"><span class="toc-number">3.2.</span> <span class="toc-text">发现实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看拓扑"><span class="toc-number">3.3.</span> <span class="toc-text">查看拓扑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#忘记实例"><span class="toc-number">3.4.</span> <span class="toc-text">忘记实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看API接口"><span class="toc-number">3.5.</span> <span class="toc-text">查看API接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用API"><span class="toc-number">3.6.</span> <span class="toc-text">调用API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#搜索实例"><span class="toc-number">3.7.</span> <span class="toc-text">搜索实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看指定实例的主库"><span class="toc-number">3.8.</span> <span class="toc-text">查看指定实例的主库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看指定实例的从库"><span class="toc-number">3.9.</span> <span class="toc-text">查看指定实例的从库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看指定实例名"><span class="toc-number">3.10.</span> <span class="toc-text">查看指定实例名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常："><span class="toc-number">3.11.</span> <span class="toc-text">打印指定主实例从库异常的列表：which-broken-replicas，模拟test3的复制异常：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#给定一个实例，列出所在集群下所有实例"><span class="toc-number">3.12.</span> <span class="toc-text">给定一个实例，列出所在集群下所有实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看所有实例"><span class="toc-number">3.13.</span> <span class="toc-text">查看所有实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看可作为pt-online-schema-change操作的副本列表"><span class="toc-number">3.14.</span> <span class="toc-text">查看可作为pt-online-schema-change操作的副本列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看集群中主实例的数据中心"><span class="toc-number">3.15.</span> <span class="toc-text">查看集群中主实例的数据中心</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将集群的主提交到KV存储"><span class="toc-number">3.16.</span> <span class="toc-text">将集群的主提交到KV存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改拓扑（迁移从库到另一个实例上）"><span class="toc-number">3.17.</span> <span class="toc-text">修改拓扑（迁移从库到另一个实例上）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#故障切换"><span class="toc-number">4.</span> <span class="toc-text">故障切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#主库宕机，自动Failover"><span class="toc-number">4.1.</span> <span class="toc-text">主库宕机，自动Failover</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到问题及解决"><span class="toc-number">5.</span> <span class="toc-text">遇到问题及解决</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#访问WEB报：html-template-“templates-layout”-is-undefined"><span class="toc-number">5.1.</span> <span class="toc-text">访问WEB报：html/template: “templates/layout” is undefined</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#glibc版本太低问题"><span class="toc-number">5.2.</span> <span class="toc-text">glibc版本太低问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#虚GTID问题"><span class="toc-number">5.3.</span> <span class="toc-text">虚GTID问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hosts没配置报错"><span class="toc-number">5.4.</span> <span class="toc-text">hosts没配置报错</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#report-host没设置报错"><span class="toc-number">5.5.</span> <span class="toc-text">report-host没设置报错</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql用户权限问题"><span class="toc-number">5.6.</span> <span class="toc-text">mysql用户权限问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GTID错误跳过"><span class="toc-number">5.7.</span> <span class="toc-text">GTID错误跳过</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"MySQL高可用探索之orchestrator　| Yangtze River's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://riverdba.github.io/2019/03/19/orchestrator/';
            this.page.identifier = '2019/03/19/orchestrator/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//https-riverdba-github-io.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/03/18/strace-mysql/" title="下一篇: 使用strace跟踪mysql的运行">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/19/orchestrator/">MySQL高可用探索之orchestrator</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/18/strace-mysql/">使用strace跟踪mysql的运行</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/mysql-data-safety/">MySQL数据安全策略</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/22/mycat-consul-mgr/">探究MyCat+Consul+MGR高可用架构</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/14/mysql57-debug/">MySQL5.7之Debug模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/14/mysql-backup/">mysql备份失败</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/09/route-add/">linux路由添加和删除</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/17/The-DB-flashback-for-MyFlash/">MySQL闪回工具之MyFlash</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/29/sqlite3-install-for-python/">python2.7安装sqlite3模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/13/mysql-transcation-uncommitted/">mysql事务未提交引发的阻塞</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/scrapy-install/">Python爬虫框架scrapy的安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/02/pt-kill/">使用pt-kill实现MySQL的过载保护</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/25/mysql-binlog-filename/">mysql binlog文件扩展序号最大是多少</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/15/mysql-performance-schema/">mysql5.6之performance schema初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/04/gdb-debug-mysql/">使用GDB调试mysql源码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/24/mycat-faq/">mycat常见问题集锦</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/24/select-on-mycat/">在mycat上使用select * 的影响</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/mycat-upgrade/">mycat1.4升级到1.5</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/21/mysql-sleep-process-too-many/">mysql sleep连接太多怎么办</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/20/online-ddl-tools-by-oak/">MySQL在线DDL工具之OAK</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/19/hive2mycat/">将hive输出文件导入mycat</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/archer-install/">archer安装及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/13/inception-install/">Inception安装及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/sysbench-for-mysql/">mysql基准测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/String-handling-of-mysql/">MySQL字符串处理一则</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/Non-SPJ-Optimization-of-mysql/">MySQL查询优化技术之非SPJ优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/MVCC-theory-study/">Innodb的MVCC实现原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/mysql-troubleshooting01/">update大量数据引发的故障</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/29/Deep-comprehend-mysql-replication/">深入理解mysql的主从复制</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/Sematic-Optimization-of-mysql/">mysql查询优化技术之语义优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/hexo-s-tips/">hexo's tips</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/hexo-s-comment/">实现hexo的评论功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/Performance-tuning-key-points-of-mysql/">mysql性能调优的关键点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/join-elimination-technique-of-mysql/">mysql查询优化技术之连接消除</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/21/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2019 一条大河
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>